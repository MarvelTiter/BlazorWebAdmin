@using System.Diagnostics.CodeAnalysis
@using Microsoft.AspNetCore.Components.Web
@using Microsoft.Extensions.Options
@using Project.Constraints.Options
@using Project.Constraints.Store.Models
@using Project.Constraints.UI
@using Project.Web.Shared.Components
@using Project.AppCore
@implements IDisposable

@UIService.AddStyles()
@UIService.UIFrameworkJs()
<VLink Href="app.css"></VLink>
<VLink Href="BlazorAdmin.Wpf.styles.css"></VLink>
<VScript Src="js/blazor-admin-project.js"></VScript>

@code {
    [Inject, NotNull] public IUIService? UIService { get; set; }
    [Inject, NotNull] LoadingControl? LoadingControl { get; set; }

    // protected override void OnAfterRender(bool firstRender)
    // {
    //     base.OnAfterRender(firstRender);
    //     if (firstRender)
    //     {
    //         LoadingControl.HeaderLoaded = true;
    //         LoadingControl.Update?.Invoke();
    //     }
    // }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        await base.OnAfterRenderAsync(firstRender);
        if (firstRender)
        {
            // 可能js没加载完成，会报错，非常恶心
            await Task.Delay(100);
            LoadingControl.HeaderLoaded = true;
            LoadingControl.Update?.Invoke();
        }
    }

    public void Dispose()
    {
        LoadingControl.HeaderLoaded = false;
    }
}